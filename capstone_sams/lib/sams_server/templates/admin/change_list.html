{% extends 'admin/change_list.html' %}
{% block object-tools %}
  {{ block.super }}
  {% load static %}
  <style>
    .retrain-button {
      background-color: #2a88e0; 
      color: #fff; 
      border: none; 
      border-radius: 8px; 
      padding: 7px 20px; 
      cursor: pointer; 
      margin-left: 10px;
    }
    .upload-button {
      background-color: #0074e4; 
      color: #fff; 
      border: none; 
      border-radius: 8px; 
      padding: 7px 20px; 
      cursor: pointer; 
    }
  </style>
  <div class="module">
    <form action="upload_dataset/" method="POST" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="file" name="file" required/>
      <button type="submit" class="upload-button">Upload Dataset</button>
    </form>
  </div>
  <div class="module">
    <form action="retrain_model/" method="POST">
      {% csrf_token %}
      <button type="submit" class="retrain-button">Retrain Model</button>
    </form>
  </div>
{% endblock %}

<script>
  $(document).ready(function () {
      $("#retrain-button").on("click", function () {
          $.ajax({
              type: "POST",
              url: "/admin/api/healthsymptom/retrain_model/",
              data: $("retrain_model/").serialize(),
              success: function (data) {
                  if (data.success) {
                      alert("Model retraining: " + data.message);
                  } else {
                      alert("Model retraining failed: " + data.message);
                  }
              },
              error: function () {
                  alert("An error occurred while retraining the model.");
              }
          });
      });

      $(".upload-button").on("click", function () {
          $.ajax({
              type: "POST",
              url: "/admin/api/healthsymptom/upload_dataset/",
              data: $("upload_dataset/").serialize(),
              success: function (data) {
                  if (data.success) {
                      alert("Dataset upload: " + data.message);
                  } else {
                      alert("Dataset upload failed: " + data.message);
                  }
              },
              error: function () {
                  alert("An error occurred while uploading the dataset.");
              }
          });
      });
  });
</script>
