{% extends 'admin/base.html' %}

{% block content %}
    <div>
        <form id='bulk_upload' name='bulk_upload' action="." method="POST" enctype="multipart/form-data">
            
            {% csrf_token %}
            <table>
                {{ form.as_table }}
            </table>
            
        </form>
        <button type="button" id="openModal" onclick="checkFormFields()">Upload File</button>
    </div>


    <div id="myModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">You're about to upload a bulk file!</h5>
          </div>
           
          <div class="modal-body">
            <table>
              {% for row in csv_data %}
                  <tr>
                      {% for cell in row %}
                          <td>{{ cell }}</td>
                      {% endfor %}
                  </tr>
              {% endfor %}
          </table>
            Are you sure to upload this file? This process is permanent and cannot be edited.
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal" id="closeModal">Close</button>
            <button type="button" class="btn btn-primary" onclick='submitForm()'>Save changes</button>
          </div>
        </div>
      </div>

    <style>
        /* Modal Styles */
        .modal {
          display: none;
          position: fixed;
          z-index: 1;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.7);
        }
      
        .modal-content {
          background-color: white;
          margin: 15% auto;
          padding: 20px;
          border: 1px solid #888;
          width: 50%;
          max-width: 500px;
          border-radius: 5px;
        }
      
        .close {
          position: absolute;
          right: 0;
          top: 0;
          padding: 10px;
          cursor: pointer;
        }
      </style>
      


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  function checkFormFields() { 
    var allFieldsFilled = true;
    $('form#bulk_upload input, form#bulk_upload select').each(function() {
      if ($(this).val() === '') {
        allFieldsFilled = false;
        return false;  
      }
    });
 
    if (allFieldsFilled) {
      $("#myModal").show();
    } else {
      
      alert('Please fill in all form fields before proceeding.');
    }
  }
  function submitForm() { 
    $('form#bulk_upload').submit();
}

  $("#closeModal").click(function() {
    $("#myModal").hide();
  });
</script>

{% endblock %}